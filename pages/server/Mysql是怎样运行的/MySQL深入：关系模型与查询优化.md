# MySQL深入：关系模型与查询优化

这篇文章主要介绍：

- mysql客户端与服务端是怎么交互的
- 关系模型
- mysql怎么进行查询优化



## 一. Client/Server交互

Mysql是典型的Client/Server(后文简称C/S)架构，客户端与服务端建立连接，发送执行命令，server进行处理。整个过程分为三个阶段。

1. **连接层**：连接管理。当新的客户端进程连接过来时，服务器进程会创建一个线程专门处理与这个客户端的交互。该客户端退出时，服务端会把这个线程缓存起来进行复用。所以线程分配太多就会影响系统性能。
2. **Server层**：解析与优化。
   - 查询缓存：对于同一个查询请求，mysql会把处理结果进行缓存。但是如果缓存系统发现该表使用了insert，update，delete等修改语句，则该表相关的所有查询缓存都将变得无效并从查询缓存中删除。
   - 语法解析：这个阶段服务端会对客户端传过来的语句进行词法和语法分析，把需要的信息如表，查询条件等存到内部使用的一些数据结构上。
   - 查询优化：客户端传来的查询条件可能执行效率并不是很高，mysql优化程序会对语句做一些优化，最后生成一个执行计划。
3. **存储引擎层**：数据存储和读取。



## 二.查询优化

1.关系代数等价原则

**关系代数等价**是指两个不同的关系代数表达式能生成相同的结果集。我们可以根据关系代数的等价交换原则做一些逻辑变换。

常见的关系代数等价原则有：

- 谓词下推
  - 尽可能早的进行过滤
  - 分解复杂的谓词条件，下推
  - 分解连接条件，笛卡尔积转join计算
- 投影下推
- 排序、limit、聚合下推
- 投影消除：无效的投影操作进行消除。
- 排序消除：如果排序规则与本身数据的排序一致的话，就可以把排序操作也消除掉。

![image-20220404175000915](https://cdn.jsdelivr.net/gh/oubindo/ImageBed@latest//img/image-20220404175000915.png)



非关联子查询：子查询中不包含非子查询的列。

如何优化？

- 子查询展开：直接执行子查询，用查询结果改写子查询的表达式。 



















